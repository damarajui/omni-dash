meta:
  name: Channel Breakdown Dashboard
  description: >
    Break down metrics by channel/source/dimension. Includes stacked bar
    chart, comparison table, and trend lines. Ideal for paid acquisition,
    marketing channel, or source attribution dashboards.
  tags: [channel, breakdown, attribution, marketing, paid]

variables:
  dashboard_name:
    type: string
    required: true
    description: Dashboard display name
  omni_model_id:
    type: string
    required: true
    description: Omni model UUID
  omni_table:
    type: string
    required: true
    description: Omni table/view name
  time_column:
    type: string
    required: true
    default: month_start
    description: Time dimension column
  dimension_column:
    type: string
    required: true
    description: Category/channel column to break down by
  metric_columns:
    type: list
    required: true
    min_length: 2
    description: Metric columns to compare across channels
  primary_metric:
    type: string
    required: true
    description: Main metric for the stacked bar chart

dashboard:
  name: "{{ dashboard_name }}"
  model_id: "{{ omni_model_id }}"
  refresh_interval: 3600
  filters:
    - field: "{{ omni_table }}.{{ time_column }}"
      type: date_range
      label: Date Range
    - field: "{{ omni_table }}.{{ dimension_column }}"
      type: multi_select
      label: "{{ dimension_column | replace('_', ' ') | title() }}"
  tiles:
    - name: "{{ primary_metric | replace('_', ' ') | title() }} by {{ dimension_column | replace('_', ' ') | title() }}"
      chart_type: stacked_bar
      query:
        table: "{{ omni_table }}"
        fields:
          - "{{ omni_table }}.{{ time_column }}"
          - "{{ omni_table }}.{{ dimension_column }}"
          - "{{ omni_table }}.{{ primary_metric }}"
        sorts:
          - column_name: "{{ omni_table }}.{{ time_column }}"
            sort_descending: false
      vis_config:
        x_axis: "{{ omni_table }}.{{ time_column }}"
        y_axis:
          - "{{ omni_table }}.{{ primary_metric }}"
        color_by: "{{ omni_table }}.{{ dimension_column }}"
        stacked: true
      position: {x: 0, y: 0, w: 12, h: 5}
    - name: Channel Comparison Table
      chart_type: table
      query:
        table: "{{ omni_table }}"
        fields:
          - "{{ omni_table }}.{{ dimension_column }}"
          - "{{ omni_table }}.{{ metric_columns[0] }}"
          - "{{ omni_table }}.{{ metric_columns[1] }}"
        sorts:
          - column_name: "{{ omni_table }}.{{ metric_columns[0] }}"
            sort_descending: true
        limit: 50
      position: {x: 0, y: 5, w: 12, h: 6}
